# Setting up AWS Environment

In this you'r going to setup your AWS accounts and development environment.

**Objective:**

1. [Create a AWS account](#create-a-aws-account)
2. [Configure users](#secure-aws-account)
3. [Set up the AWS CLI](#set-up-the-aws-cli)

## Create a AWS account

Here are the following steps to create an AWS Account

Visit [aws.amazon.com](https://aws.amazon.com/) and choose [Create Account](https://signin.aws.amazon.com/signup?request_type=register).

### Step 1: Select email, account name, and password

Make root user id,

1. Put **Email** and **Account name**:
    - Personal account: Use your **personal email**, not your work email (you might
    change jobs).
    - Business account: Use a **shared or team-managed email alias**, not one tied
    to a single person (roles can change).
    - Account name: Use a **username** for account
2. **Verify email address** with verification code.
3. **Create root user password**.
4. Pick **Free** or **Paid** plan.
5. Continue.

### Step 2: Add contact information

Contact information,

1. Select between Business or Personal use.

    There is not much difference but for Business
    - has different type of information required to open the account for billing
    purposes.
    - choose a **phone number** that tied to Business
2. Enter **Contact Details** and save this information.

    In case if you lose the email or 2FA device. AWS Support can use this details
    to conform your idenity.
3. Accept the AWS Customer Agreement.
4. Optional, uncheck nearest region.
5. Continue.

### Step 3: Add payment method

Billing information,

1. Add **Card Details**. (Use Credit card, debit might not work)
2. Provide **PAN** now or leave it for later.
3. Continue.

### Step 4: Confirm your identity

Verify account,

1. Choose a verification method,
    - SMS (text message)
    - Voice Call
2. Solve Captcha.
3. Enter Code.
4. Continue.

### Step 5: Select support Plan

Final Step,

1. Choose support plan.
2. Click **Complete sign up**.

Your AWS account sign up completed.

### Q&A

**Q:** What's a root user?

**A:** Root user,

- is created automatically once you done with signup.
- is a special entity that has **Full access** to the account.
- have complete access to AWS services and resources in the account.

## Secure AWS Account

Because root user has complete access to AWS services and resources, it require
need to secured, aws recommend:

- Enable additional security for the root user with multi-factor authentication.
- Set up additional users to perform daily tasks related to your account.

So let's begin,

### Step 1: Sign in as the root user

1. Visit [AWS Management Console](https://aws.amazon.com/console/),
click **Sign in**.
2. Select **Root user** and enter **Email**, then **Next**.
3. Enter **Password**.

### Step 2: Add more security to the root user sign in

Add an MFA (Multi-Factor Authentication) device,

1. Click on right-top corner **Account ID**.
2. Select **Security credentials**.
3. Click on **Assign MFA device**.
4. Enter **Device name**.
5. Select **MFA device**.
    - **Passkey** - fingerprint, face or screen lock
    - **Authenticator app** - Authy, Google/Microsoft Authenticator apps.
    - **Hardware TOTP token** - use a code generated by h/w totp token.

    Here **Authenticator app** is selected. Select **Next**.
6. Download an app on mobile device and scan **Show QR code**.
7. Enter two MFA code which come one after another in the app.
8. Click **Add MFA**.

Once done, it shown in Security credentials page.

### Step 3: Set up users in IAM Identity Center

Using root account is not a best practice for everyday task. So we are using
**IAM Identity Center** for,

- To users get **temporary, unique credentials** each session.
- To admins can create and group users by **job roles** with specific permissions.
- To users automatically gain access to the **AWS Billing and Cost Management console.**

**Objective:**

1. Enable IAM Identity Center
    - Add users
    - Add users to groups
2. Configure your identity source
3. Create an administrative permission set
4. Sign in to the AWS access portal with your administrative credentials

#### 1. Enable IAM Identity Center

1. Search **IAM Identity Center**, then select it.
2. **Enable** IAM Identity Center.
3. **Enable** AWS Organizations.

    - Turning on IAM Identity Center also enables Organizations.
    - Lets you organize multiple AWS accounts so that you can have separate AWS accounts
    for different use cases.
    - Your root user becomes the organizationâ€™s management account.
    - Root user gets a verification email.

#### 2. Configure your identity source

Add User,

1. Search **IAM Identity Center**, then select it.
2. On Left, look of **Users** and select **Add user**.
3. Add user details. For example
    - **username** - John
    - **password** - Send an email to this user
    - **email address** - [*rootuseremail+john@example.com*](url) (this use email
    subaddressing)
    - **first name** - John
    - **last name** - Smith

    Click **Next**.
4. Optional, Add user to group.

    1. Click on **Create group**. It open in new tab.
    2. Add group details. For example
        - **Group name** - Admin

        Click **Create group** on left-bottom.
    3. Come back to user tab, refresh group list.
    4. Tick **Admin** group.
    5. Click **Next**.

5. Review and Click on **Add user**.

It tells, the a link send on user email which is valid for upto 7 days.

#### 3. Create an administrative permission set

User John still not has permission to do anything, so let give him administrative
permission.

We still using root account.

1. Open **IAM Identity Center** > **Dashboard**.
2. Look for **Manage permissions to multiple AWS accounts** and click **Manage permissions**.
3. On left, click on **AWS Accounts**.
4. Click on account name below root.
5. Click on **Assign user or groups**.
6. Check on **Admin** group, then **Next**.
7. Click on **Create permission set**, open on new tab.

    1. Select Permission set type
        - Type - **Predefined permission set**
        - Policy for predefined permission set - **AdministratorAccess**

        Click **Next**.
    2. Specify permission set details

        Keep all default, hit **Next**.
    3. Review and click **Create**.
8. Return to **Assign user and group** tab and refresh permission set list.
9. Check permission set - **AdministratorAccess**, Click **Next**.
10. Review and **Submit**. Wait for complete verify configuration.
11. Once completed, it gives a notification.

#### 4. Sign in to the AWS access portal with your administrative credentials

If you still yet to verify john account,

1. Go to your email inbox. (no need to add +john part)
2. Click Verify Or URL link in below.
3. New Tab will open, put username (i.e John), then **Next**.
4. Enter Password.
5. Do MFA verification.

You get management console of john,

1. In **Accounts**, click to expand account name.
2. Click on **AdministratorAccess**.

You enter in that account with Administrator priviliages.

**Note:** Each AWS Organization has a unique access portal URL.
Make sure you keep a record of it with your user sign-in information.

## Set Up the AWS CLI

The AWS CLI is a unified tool to manage your AWS services.

In this module, you will learn how you can set up multiple profiles to access
more than one AWS account, either with additional credentials, or through IAM role
switching.

### 1. Install the AWS CLI

Click on [Install AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html#getting-started-install-instructions),
choose depending upon your OS.

Click here => [Install for Linux](./install.sh)

### Step 2: Configure the AWS CLI

So we configure for John here,

- SSO session name: John
- SSO start URL: The URL can be found in the Settings summary in the IAM Identity
Center console Dashboard.
- SSO region: You can find this information in the Settings summary in the IAM
Identity Center console Dashboard.
- SSO registration scopes: Scopes authorize access to different endpoints.

Let's start,

1. Run configuration command

        aws configure sso

2. Enter SSO details

    - SSO session name (Recommended): `John`
    - SSO start URL [None]: `<https://my-sso-portal.awsapps.com/start>`
    - SSO region [None]: `<us-east-1>`
    - SSO registration scopes [None]: `sso:account:access`

3. Grant permission, once ask in browser. Close the tab.
4. Review available accounts.

    Navigate back to your CLI window. The CLI will update and show you the AWS accounts
    and roles that are available to you.

    - Because you have only set up one AWS account with the AdministratorAccess role
    at this point that is the account and role you are signed in with.
5. Set CLI preferences

    - **CLI default client Region [\<your-region\>]**: enter the Region where you
    enabled IAM Identity Center. For this tutorial we used us-east-1
    - **CLI default output format [None]**: enter json
    - **CLI profile name [AdministratorAccess-xxxxxxxxxxxx]**: enter admin-1

    To use this profile,

        aws s3 ls --profile admin-1

6. To view configuration,

        less ~/.aws/config

7. Start SSO session,

        aws sso login --profile admin-1

8. Enter username, password and MFA. Once authentication complete goes back to terminal.
9. Complete authentication

    Navigate to the browser window and allow access to your data.
    When you return to the CLI window the following message should be displayed:

    Successfully logged into Start URL: `https://my-sso-portal.awsapps.com/start`

## Conclusion

Congratulations! You have now completed the sign-in process, created an administrative
user in IAM Identity Center, added enhanced security for both your root user and
your administrative user, and set up the AWS CLI and configured a named profile.
